<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini API Setup Guide - Tod AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 32px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 18px;
        }
        
        .step {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .step h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .step-number {
            background: #667eea;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .step p {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }
        
        .step a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }
        
        .step a:hover {
            text-decoration: underline;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px 10px 10px 0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        input[type="text"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            margin: 10px 0;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
        }
        
        #result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            display: none;
        }
        
        #result.success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            display: block;
        }
        
        #result.error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            display: block;
        }
        
        #result.loading {
            background: #d1ecf1;
            border: 2px solid #17a2b8;
            color: #0c5460;
            display: block;
        }
        
        .warning-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .warning-box strong {
            display: block;
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .success-box {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }
        
        .success-box.show {
            display: block;
        }
        
        code {
            background: #f4f4f4;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }
        
        .model-list {
            background: white;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        
        .model-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 6px;
            font-family: monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Gemini API Setup Guide</h1>
        <p class="subtitle">Get your Tod AI app powered by Google's Gemini AI in 3 simple steps!</p>
        
        <div class="warning-box">
            <strong>‚ö†Ô∏è Important First Step</strong>
            <p>The Gemini API must be enabled before you can use it. Follow the steps below carefully!</p>
        </div>
        
        <!-- Step 1 -->
        <div class="step">
            <h2>
                <span class="step-number">1</span>
                Get Your API Key
            </h2>
            <p>Visit Google AI Studio to create your free API key:</p>
            <p>üëâ <a href="https://aistudio.google.com/app/apikey" target="_blank">https://aistudio.google.com/app/apikey</a></p>
            <p>Click <strong>"Create API Key"</strong> and copy it to your clipboard.</p>
        </div>
        
        <!-- Step 2 -->
        <div class="step">
            <h2>
                <span class="step-number">2</span>
                Enable the Generative Language API
            </h2>
            <p><strong style="color: #dc3545;">THIS IS REQUIRED!</strong> Your API key won't work until you enable this API:</p>
            <p>üëâ <a href="https://console.cloud.google.com/apis/library/generativelanguage.googleapis.com" target="_blank">Click here to enable the API</a></p>
            <p>1. Click the <strong>"ENABLE"</strong> button</p>
            <p>2. Wait 1-2 minutes for the API to activate</p>
            <p>3. You may need to set up billing (free tier available with no charges for basic usage)</p>
        </div>
        
        <!-- Step 3 -->
        <div class="step">
            <h2>
                <span class="step-number">3</span>
                Test Your API Key
            </h2>
            <p>Paste your API key below and click "Test API Key" to verify it's working:</p>
            
            <input 
                type="text" 
                id="apiKey" 
                placeholder="Paste your API key here (e.g., AIzaSy...)"
                value=""
            />
            
            <div style="margin-top: 15px;">
                <button onclick="testAPIKey()">üß™ Test API Key</button>
                <button onclick="listModels()">üìã List Available Models</button>
                <button onclick="saveAPIKey()">üíæ Save to Tod AI</button>
            </div>
            
            <div id="result"></div>
        </div>
        
        <div class="success-box" id="successBox">
            <strong>‚úÖ Success!</strong>
            <p>Your API key is working! You can now use it in Tod AI.</p>
            <p style="margin-top: 10px;">Click the <strong>"Save to Tod AI"</strong> button above to automatically save it to your browser's localStorage, or manually copy-paste it into the Tod AI settings (‚öôÔ∏è icon).</p>
        </div>
        
        <!-- Troubleshooting -->
        <div class="step">
            <h2>
                <span class="step-number">‚ùì</span>
                Troubleshooting
            </h2>
            
            <p><strong>Error: "No models available"</strong></p>
            <p>‚Üí Make sure you completed Step 2 above and enabled the API</p>
            <p>‚Üí Wait 1-2 minutes after enabling the API</p>
            <p>‚Üí Refresh this page and try again</p>
            
            <p style="margin-top: 15px;"><strong>Error: "API key not valid"</strong></p>
            <p>‚Üí Double-check you copied the entire API key from Google AI Studio</p>
            <p>‚Üí Make sure there are no extra spaces</p>
            
            <p style="margin-top: 15px;"><strong>Error: "Billing must be enabled"</strong></p>
            <p>‚Üí Visit <a href="https://console.cloud.google.com/billing" target="_blank">Google Cloud Billing</a></p>
            <p>‚Üí Set up billing (the free tier is generous and won't charge you for basic usage)</p>
        </div>
    </div>

    <script>
        // Load API key from localStorage if available
        window.addEventListener('load', () => {
            const stored = localStorage.getItem('gemini_api_key');
            if (stored) {
                document.getElementById('apiKey').value = stored;
            }
        });

        async function testAPIKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const resultDiv = document.getElementById('result');
            const successBox = document.getElementById('successBox');
            
            successBox.classList.remove('show');
            
            if (!apiKey) {
                resultDiv.className = 'error';
                resultDiv.textContent = '‚ùå Please enter your API key first!';
                return;
            }
            
            resultDiv.className = 'loading';
            resultDiv.textContent = '‚è≥ Testing your API key...\n\nThis may take a few seconds...';
            
            try {
                // First, try to list models
                const listResponse = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`
                );
                
                const listData = await listResponse.json();
                
                if (listData.error) {
                    resultDiv.className = 'error';
                    let errorMsg = '‚ùå API KEY ERROR\n\n';
                    errorMsg += `Error: ${listData.error.message}\n\n`;
                    
                    if (listData.error.code === 400) {
                        errorMsg += 'üìù SOLUTION:\n';
                        errorMsg += '1. Visit: https://console.cloud.google.com/apis/library/generativelanguage.googleapis.com\n';
                        errorMsg += '2. Click "ENABLE"\n';
                        errorMsg += '3. Wait 1-2 minutes\n';
                        errorMsg += '4. Try again!';
                    } else if (listData.error.code === 403) {
                        errorMsg += 'üìù SOLUTION:\n';
                        errorMsg += 'Your API key may have restrictions.\n';
                        errorMsg += '1. Check your API key at https://aistudio.google.com/app/apikey\n';
                        errorMsg += '2. Make sure the Generative Language API is enabled\n';
                        errorMsg += '3. Verify billing is set up (free tier available)';
                    }
                    
                    resultDiv.textContent = errorMsg;
                    return;
                }
                
                if (listData.models && listData.models.length > 0) {
                    // Try to actually call the API
                    const generateModels = listData.models.filter(m => 
                        m.supportedGenerationMethods && 
                        m.supportedGenerationMethods.includes('generateContent')
                    );
                    
                    if (generateModels.length > 0) {
                        const modelId = generateModels[0].name.replace('models/', '');
                        
                        const testResponse = await fetch(
                            `https://generativelanguage.googleapis.com/v1beta/models/${modelId}:generateContent?key=${apiKey}`,
                            {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({
                                    contents: [{
                                        parts: [{ text: 'Say "Hello" if you can read this!' }]
                                    }]
                                })
                            }
                        );
                        
                        const testData = await testResponse.json();
                        
                        if (testData.candidates && testData.candidates[0]) {
                            resultDiv.className = 'success';
                            let msg = '‚úÖ SUCCESS! Your API key is working!\n\n';
                            msg += `Model tested: ${modelId}\n`;
                            msg += `Response: ${testData.candidates[0].content.parts[0].text}\n\n`;
                            msg += `Found ${generateModels.length} available models:\n`;
                            generateModels.forEach((m, i) => {
                                msg += `${i + 1}. ${m.name.replace('models/', '')}\n`;
                            });
                            resultDiv.textContent = msg;
                            successBox.classList.add('show');
                        } else {
                            throw new Error('Could not generate content');
                        }
                    } else {
                        resultDiv.className = 'error';
                        resultDiv.textContent = '‚ùå No models support text generation.\n\nPlease check your API key permissions.';
                    }
                } else {
                    resultDiv.className = 'error';
                    resultDiv.textContent = '‚ùå No models available.\n\nMake sure you enabled the Generative Language API:\nhttps://console.cloud.google.com/apis/library/generativelanguage.googleapis.com';
                }
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.textContent = `‚ùå REQUEST FAILED\n\nError: ${error.message}\n\nPlease check:\n1. Your internet connection\n2. That you enabled the Generative Language API\n3. That your API key is correct`;
            }
        }
        
        async function listModels() {
            const apiKey = document.getElementById('apiKey').value.trim();
            const resultDiv = document.getElementById('result');
            
            if (!apiKey) {
                resultDiv.className = 'error';
                resultDiv.textContent = '‚ùå Please enter your API key first!';
                return;
            }
            
            resultDiv.className = 'loading';
            resultDiv.textContent = '‚è≥ Fetching available models...';
            
            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`
                );
                
                const data = await response.json();
                
                if (data.error) {
                    resultDiv.className = 'error';
                    resultDiv.textContent = `‚ùå ERROR\n\n${data.error.message}\n\nMake sure you enabled the API:\nhttps://console.cloud.google.com/apis/library/generativelanguage.googleapis.com`;
                    return;
                }
                
                if (data.models && data.models.length > 0) {
                    const generateModels = data.models.filter(m => 
                        m.supportedGenerationMethods && 
                        m.supportedGenerationMethods.includes('generateContent')
                    );
                    
                    resultDiv.className = 'success';
                    let msg = `‚úÖ Found ${data.models.length} total models\n`;
                    msg += `üìù ${generateModels.length} models support text generation:\n\n`;
                    
                    generateModels.forEach((m, i) => {
                        const modelId = m.name.replace('models/', '');
                        msg += `${i + 1}. ${modelId}\n`;
                        msg += `   ${m.displayName || 'No description'}\n\n`;
                    });
                    
                    resultDiv.textContent = msg;
                } else {
                    resultDiv.className = 'error';
                    resultDiv.textContent = '‚ùå No models found!\n\nPlease enable the Generative Language API first.';
                }
            } catch (error) {
                resultDiv.className = 'error';
                resultDiv.textContent = `‚ùå Error: ${error.message}`;
            }
        }
        
        function saveAPIKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            
            if (!apiKey) {
                alert('‚ùå Please enter an API key first!');
                return;
            }
            
            localStorage.setItem('gemini_api_key', apiKey);
            alert('‚úÖ API key saved to localStorage!\n\nYou can now use it in Tod AI. Just refresh the Tod AI page if it\'s already open.');
        }
    </script>
</body>
</html>
